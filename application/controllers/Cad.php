<?phpclass Cad extends CI_Controller {    public function __construct() {        parent::__construct();        $this->load->model('user_model');        $this->load->model('cad_model');        $this->load->library('email');        $this->load->library('upload');        $this->load->model('beamon_model');        $this->load->helper('date');        if (!$this->session->userdata('logged_in')) {            redirect('welcome');        }        $conditions = $this->user_model->user_rights($_SESSION["user_id"]);        $userright = array();        foreach ($conditions as $rights) {            array_push($userright, $rights->sm_id);        } //print_r($userright);exit;        $right = array(0 => '1');        if (!in_array('1', $userright)) {            echo "<script type='text/javascript'>alert('Access denied');</script>";            redirect('/admin');        }    }    public function index() {//        print_r($this->beamon_model->get_order_details());//        exit;        $date = date("2015-04-17");        $this->load->model('cad_model');        $data['completed'] = $this->cad_model->get_cad_status('2', $date);        $data['pending'] = $this->cad_model->get_cad_status('1', $date);        $data['hold'] = $this->cad_model->get_cad_status('0', $date);        $date = date("2014-03-24");        $data['high'] = $this->cad_model->get_cad_status('2', '1', $date);        $data['normal'] = $this->cad_model->get_cad_status('1', '1', $date);        $data['low'] = $this->cad_model->get_cad_status('0', '1', $date);        $this->template->build("cad/cad_orders", $data);    }    public function cad_new_job() {        header('Access-Control-Allow-Origin: *');        $this->load->view('cad/cad_popup');//        header('Access-Control-Allow-Origin: *');        $id = $_GET['job_id'];        $data['jobs'] = $this->user_model->get_job_updates($id, TBL_JOBS, 'job_id');        $data['updates'] = $this->user_model->get_job_updates($id, TBL_JOBS_UPDATES, 'job_id');        $cust_id = $data['jobs'][0]->cust_id;        $data['customer'] = $this->user_model->get_job_updates($cust_id, TBL_CUSTOMER, 'cust_id');        $data['user'] = $this->user_model->get_job_update_join($data['jobs'][0]->job_id);        $this->load->view('cad/cad_popup', $data);    }    public function cad_mail_to_customer() {        header('Access-Control-Allow-Origin: *');        if ($this->input->post()) {            $data = $this->input->post();            $config['protocol'] = 'smtp';            if ($this->user_model->has_permission($_SESSION["user_id"])) {                $data = $this->input->post();                $config['protocol'] = 'smtp';                $config['smtp_host'] = 'ssl://smtp.gmail.com';                $config['smtp_port'] = '25';                $config['smtp_port'] = '465';                $config['smtp_timeout'] = '7';                $config['smtp_user'] = 'sribabuixly@gmail.com';                $config['smtp_pass'] = '123456sri';                $config['charset'] = 'utf-8';                $config['newline'] = "\r\n";                $config['mailtype'] = 'text'; // or html                $config['validation'] = TRUE; // bool whether to validate email or not                      $this->email->initialize($config);                $config['smtp_host'] = 'ssl://smtp.gmail.com';                $config['smtp_port'] = '25';                $config['smtp_port'] = '465';                $config['smtp_timeout'] = '7';                $config['smtp_user'] = 'sribabuixly@gmail.com';                $config['smtp_pass'] = '123456sri';                $config['charset'] = 'utf-8';                $config['newline'] = "\r\n";                $config['mailtype'] = 'text'; // or html                $config['validation'] = TRUE; // bool whether to validate email or not                      $this->email->initialize($config);//            $config = Array(//                'protocol' => 'smtp',//                'smtp_host' => 'ssl://smtp.googlemail.com',//                'smtp_port' => 465,//                'smtp_user' => 'sribabuixly@gmail.com', // change it to yours//                'smtp_pass' => '123456sri', // change it to yours//                'mailtype' => 'html',//                'charset' => 'iso-8859-1',//                'wordwrap' => TRUE//            );                // $this->upload->initialize($config);//            if (!$this->upload->do_upload('attachment')) {//                $error = array('error' => $this->upload->display_errors());//                $this->template->build('admin/add_user', $error);//            } else {//                $uploaded = $this->upload->data();//                $data["attachment"] = $uploaded["file_name"];//                //echo json_encode(array("status" => "success", "filename" => $uploaded["file_name"]));//            }                // $this->load->library('upload', $config);                $this->email->set_newline("\r\n");                $this->email->from('sribabuixly@gmail.com', 'sribabu');                $this->email->to('sribabuixly@gmail.com');                $this->email->cc('sribabuixly@gmail.com');                //$this->email->attach('http://localhost/wims2/upload/$data["attachment"]');                $this->email->attach('http://www.beamon.com/wims2/upload/abc.jpg');                $this->email->subject('test');                $this->email->send();                if (!$this->email->send()) {                    echo "Error Sending email";                    $this->upload->initialize($config);                    if (!$this->upload->do_upload('attachment')) {                        $error = array('error' => $this->upload->display_errors());                        $this->template->build('admin/add_user', $error);                    } else {                        $uploaded = $this->upload->data();                        $data["attachment"] = $uploaded["file_name"];                        //echo json_encode(array("status" => "success", "filename" => $uploaded["file_name"]));                    }                    $this->load->library('upload', $config);                    $this->email->set_newline("\r\n");                    $this->email->from('$_SESSION["user_email"]', '$_SESSION["user_name"]');                    $this->email->to('$data["email"]');                    $this->email->cc('$data["ccemail"]');                    $this->email->attach('http://www.beamon.com/wims2/upload/$data["attachment"]');                    $this->email->subject('$data["subject"]');                    $this->email->send();                    if (!$this->email->send()) {                        echo "Error Sending email";                    } else {                        redirect('cad');                    }                } else {                    echo "<script type='text/javascript'>alert('Access denied');</script>";                    redirect('cad');                }            }            $this->load->view('cad/mail_to_customer');        }    }    public function upload_attachment() {        $config['upload_path'] = realpath(APPPATH . '../upload/');        $config['allowed_types'] = 'gif|jpg|png';        $config['file_name'] = "cad.jpg";        $this->upload->initialize($config);        if (!$this->upload->do_upload('usr_photo')) {            $error = array('error' => $this->upload->display_errors());            $this->template->build('admin/add_user', $error);        } else {            $uploaded = $this->upload->data();            $data["attachment"] = $uploaded["file_name"];            echo json_encode(array("status" => "success", "filename" => $uploaded["file_name"]));        }    }    public function view_job_info() {        if ($this->input->post()) {            $data = $this->input->post();            if ($data['update_type'] = 0) {                $this->user_model->update_job($data);            } else if ($data['update_type'] = 1) {                $data['job_status'] = -1;                $this->user_model->update_job($data);            } redirect('admin/order_status');        }        $id = $_GET['job_id'];        $data['jobs'] = $this->user_model->get_job_updates($id, TBL_JOBS, 'job_id');        $data['updates'] = $this->user_model->get_job_updates($id, TBL_JOBS_UPDATES, 'job_id');        $cust_id = $data['jobs'][0]->cust_id;        $data['customer'] = $this->user_model->get_job_updates($cust_id, TBL_CUSTOMER, 'cust_id');        $data['user'] = $this->user_model->get_job_update_join($data['jobs'][0]->job_id);        $this->load->view('admin/update_job_popup', $data);    }    public function send_to_laser() {        $data['job_cad_status'] = '2';        $data['job_id'] = $_POST['job_id'];        $this->cad_model->cad_status($data);        $data['update_date'] = date('Y-m-d');        $data['update_time'] = date('Y-m-d H:i:s');        $data['job_cad_status'] = $data['update_for'] = '2';        $data['update_status'] = '1';        $data['update_to'] = 'CAD - Completed';        $data['update_by'] = $_SESSION['user_id'];        $data['update_remarks'] = $_POST['update_remarks'];        $this->cad_model->update_job($data);        //  redirect('cad');    }}